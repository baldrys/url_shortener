# url_shortener
Приложение генерирует укороченную версию оригинального url, переходя по которому происходит перенаправление на оригинальный адресс.

Реализовано на `python 3.6` и `django 1.11.9`.

## Описание

1. Приложение имеет форму ввода `url`, валидация которого происходит проверкой кода ответа от запроса по введенному url, 
используя библиотеку [requests](http://docs.python-requests.org/en/master/) .
Код валидации находится в модуле `shortener/validations.py` функция `validate_url()`.

2. Приложение генерирует `shortcode` для оригинального `url`, при сохранении в базу данных - метод `save()` модели `ShortURL`, который вызывает 
генератор случайной строки из модуля `shortener/utils.py`.

3. Возможен ввод желаемого короткого url указывая только `shortcode` (хост добавляется автоматически в view функции)

4. Приложение проверяет не был ли уже использован этот shortcode и выводит сообщение об ошибке при его повторном вводе.
Код валидации находится в модуле `shortener/validations.py`, функция `validate_desired_shortcode()`.

5. Приложение хранит в базе данных оригинальный `url` и `shortcode`, метод `as_view()` класса `URLRedirectView` в модуле `shortener/views.py` 
принимает данный `shortcode` в get запросе, находит его в бд и перенаправляет на связанный с ним оригинальный `url`.

6. Логирование выполняется в файл `output.log`.

7. Для удаления записей из базы данных, дата создания которых перевысила определенный срок была создана `management-command` - `purge_old_data`.
`python manage.py purge_old_data` для автоматического запуска которой можно воспользоватся `cron`.

8. В базе данных хранится количество переходов по коротким `url` которое подсчитывается в class based view: `URLRedirectView`.

9. API для создания коротких `url` было реализовано с помощью модуля `djangorestframework`. 
Создание короткого `url`: `POST` запрос на `api/shorturl/` с передачей только `url` или `url` и `shortcode`. 
Получить, изменить и удалить короткий `url` можно с помощью запросов: `GET`, `PATCH`, `DELETE` на `api/{pk}`, 
где `pk` индекс в бд.

# Запуск на локальном сервере

Перед запуском на локальном сервере необходимо установить следующие пакеты: `Django==1.11.9`, `requests`, `djangorestframework` и запустить команду 
`python manage.py runserver`.

# Heroku

Данное приложение загружено на облачный сервис [heroku](https://www.heroku.com/) по адрессу: https://short-url420.herokuapp.com/.

К сожалению, автоматическое удаление записей на данный момент не работает.
